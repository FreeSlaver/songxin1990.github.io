---
layout: page

title: 异地多活架构设计
category: architecture-design
categoryStr: 架构设计
tags: [异地多活]
keywords:
description:
---

还是从最经典，最科学的5w1h入手，
## Why 为什么要搞异地多活？
现在假设极端一点的情况：你们公司在中东的机房被胡塞武装给炸了，所有服务瘫痪，客户，用户无法访问。一天可能造成上千万，上亿的损失，  
更深远的是会在客户，用户心理造成恶劣影响，甚至有的可能会造成数据资产消失，公司倒闭。
这种情况该怎么办？有没一种方案能够：一键切换，迅速将所有服务指向到备用机房。这就是异地多活。

## What 什么是异地多活？
异地多活：主要是为了保证服务的高可用性。上面举得例子可能夸张了点，但是现实中导致服务瘫痪，完全无法访问的情况太多了。  
你大脑中过一下，整个访问服务，网站，APP的过程，几乎所有节点都可能出问题掉链子，而且这些环节是无法保证100%安全可靠的，  
关键在于发生了故障以后，如何迅速应对，恢复服务。   
比如软件上：DNS被劫持，污染，Nginx挂掉，应用服务进程挂掉，微服务集群掉线，redis缓存集群雪崩，MySQL查询阻塞假死，  
Kafka集群挂掉，应用程序CPU飙升不响应等等。   
硬件上：CPU、内存、磁盘、网卡、交换机、路由器等等都可能故障  
其他不可抗力：机房断电，线缆被挖断，地震、水灾、火灾、战争导致机房不可用，数据完全丢失。  

### 异地多活最主要的2个目的：
1.保证服务高可用，减少公司业务经济损失，不造成对客户，用户的恶劣影响
2.容灾备份，能够在最极端的情况下，依然保证数据资产安全

## Who 谁，什么样的公司，场景适合搞异地多活？
越是核心业务，用户量大，7*24小时提供的服务越需要搞异地多活，特别是那些重大的金融资产，数字资产，用户高价值的企业越需要。
## Where 在哪里搞异地多活？
现在云服务非常的便捷，你只需要在阿里云，腾讯云，AWS等上面直接采购不同地区的云服务器即可，这些大厂几乎在全球的重要数据中心都有自己搭建的机房。
## How 怎么搞异地多活？
没那么复杂，首先就直接假设这么一种情况：你们公司的机房停电了，或者网络光纤被挖断了，整个业务直接停摆，瘫痪，24小时后来电，你怎么做？？？
甚至再严重一点的，你们业务系统所在的硬盘坏了，烧了，你怎么办？
首先最重要的一点是：保证数据资产安全。所以我们要做数据备份。
怎么备份了？拿一般的MySQL来说把，本身就提供各种备份策略，但是数据存在哪里了？百度网盘？哈哈，也不是不可以，把数据加密下，改个什么葫芦娃的名字，
别人不感兴趣就一般不会泄露。
但是一般公司业务数据都是非常敏感的，暴露在公网肯定不太行，所以最好的是存储在机房。那如果存在同一个机房，假设这个机房发火灾了，这2份数据同时被毁了，怎么办？
所以最好是将数据存在不同的机房。OK，这就是说的异地冷备。  

但是，新的问题又来了，虽然数据保住了，但是停电了，业务停摆了，怎么弄？
最简单的，搞一套和本机房一模一样的服务部署就行了，自己将所有请求转移，打到新机房上，然后接上冷备数据，是不是就可以了？  
这个就是同城双活。



### 异地多活的难点是什么？
状态转移，中间状态的事务回滚，恢复。

找份工作，然后学习，看书，编程，炒股。


## 会什么？赚谁的钱？



